---
import './StorageFileBrowser.css';
import { translations } from './StorageFileBrowser.translations';

/**
 * StorageFileBrowser Component (Web Component Wrapper)
 * 
 * A reusable file browser modal for selecting files from cloud storage.
 * Can be triggered by any button and fills the selected file URL into an input.
 * 
 * @example
 * <StorageFileBrowser 
 *   triggerId="browse-btn" 
 *   targetInputId="file-url-input"
 *   title="Select Image"
 *   fileTypes={['image/jpeg', 'image/png', 'image/webp']}
 * />
 */

interface Props {
  /** ID of the button that triggers the browser */
  triggerId: string;
  /** ID of the input field to populate with selected file URL */
  targetInputId: string;
  /** Filter by file types (MIME types) */
  fileTypes?: string[];
  /** Show only files (hide folders) */
  filesOnly?: boolean;
  /** Return type: 'url' | 'identifier' | 'key' */
  returnType?: 'url' | 'identifier' | 'key';
  /** API endpoint for S3 operations */
  apiEndpoint?: string;
  /** Locale storage key */
  localeStorageKey?: string;
}

const { 
  triggerId, 
  targetInputId,
  fileTypes = [],
  filesOnly = false,
  returnType = 'url',
  apiEndpoint = '/api/storage',
  localeStorageKey = 'storage-browser:locale',
} = Astro.props;

// Convert fileTypes array to JSON string for the custom element
const fileTypesJson = JSON.stringify(fileTypes);
---

<storage-file-browser
  trigger-id={triggerId}
  target-input-id={targetInputId}
  file-types={fileTypesJson}
  files-only={filesOnly.toString()}
  return-type={returnType}
  api-endpoint={apiEndpoint}
  translation-map={JSON.stringify(translations)}
  locale-storage-key={localeStorageKey}
></storage-file-browser>

<script src="./StorageFileBrowser.ts"></script>
