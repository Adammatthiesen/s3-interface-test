---
import StorageFileBrowser from '../components/StorageFileBrowser.astro';
import StorageImage from '../components/StorageImage.astro'
import '../styles.css';
---

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>StorageFileBrowser File Browser Demo</title>
  <style>
    .demo-container {
      max-width: 800px;
      margin: 2rem auto;
      padding: 2rem;
    }

    .demo-section {
      background: white;
      border-radius: 12px;
      padding: 2rem;
      margin-bottom: 2rem;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .demo-section h2 {
      margin-top: 0;
      color: #333;
    }

    .form-group {
      margin-bottom: 1.5rem;
    }

    .form-group label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 500;
      color: #333;
    }

    .input-with-button {
      display: flex;
      gap: 0.5rem;
    }

    .form-input {
      flex: 1;
      padding: 0.75rem;
      border: 1px solid #dee2e6;
      border-radius: 6px;
      font-size: 0.875rem;
      font-family: monospace;
    }

    .browse-btn {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 0.75rem 1.5rem;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 500;
      transition: all 0.2s;
    }

    .browse-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }

    .code-block {
      background: #f8f9fa;
      border-radius: 6px;
      padding: 1rem;
      font-family: monospace;
      font-size: 0.875rem;
      overflow-x: auto;
      margin-top: 1rem;
    }

    .preview-box {
      margin-top: 1rem;
      padding: 1rem;
      border: 2px dashed #dee2e6;
      border-radius: 6px;
      min-height: 100px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .preview-box img {
      max-width: 100%;
      max-height: 300px;
      border-radius: 4px;
    }

    .preview-box.empty {
      color: #6c757d;
    }
  </style>
</head>
<body>
  <div class="demo-container">
    <div class="demo-section">
      <h2>StorageFileBrowser File Browser Component Demo</h2>
      <p style="color: #6c757d;">Click the "Browse" buttons to open the file browser and select files from your storage.</p>
    </div>

    <div class="demo-section">
      <StorageImage identifier="storage-file://uploads/1765388443236-example2.png" alt='example2' />
    </div>

    <!-- Example 1: Select any file (URL) -->
    <div class="demo-section">
      <h2>Example 1: Select File URL</h2>
      <div class="form-group">
        <label for="file-url">File URL:</label>
        <div class="input-with-button">
          <input type="text" id="file-url" class="form-input" placeholder="Click Browse to select a file..." readonly>
          <button id="browse-url-btn" class="browse-btn">Browse</button>
        </div>
      </div>
      <div class="code-block">
&lt;StorageFileBrowser 
  triggerId="browse-url-btn" 
  targetInputId="file-url"
  returnType="url"
/&gt;
      </div>
    </div>

    <!-- Example 2: Select image only (identifier) -->
    <div class="demo-section">
      <h2>Example 2: Select Image (Identifier)</h2>
      <div class="form-group">
        <label for="image-identifier">Image Identifier:</label>
        <div class="input-with-button">
          <input type="text" id="image-identifier" class="form-input" placeholder="Select an image..." readonly>
          <button id="browse-image-btn" class="browse-btn">Browse Images</button>
        </div>
      </div>
      <div id="image-preview" class="preview-box empty">
        No image selected
      </div>
      <div class="code-block">
&lt;StorageFileBrowser 
  triggerId="browse-image-btn" 
  targetInputId="image-identifier"
  title="Select Image"
  fileTypes={['image/jpeg', 'image/png', 'image/webp', 'image/gif']}
  returnType="identifier"
/&gt;
      </div>
    </div>

    <!-- Example 3: Select Storage key only -->
    <div class="demo-section">
      <h2>Example 3: Select Storage Key</h2>
      <div class="form-group">
        <label for="storage-key">Storage Key:</label>
        <div class="input-with-button">
          <input type="text" id="storage-key" class="form-input" placeholder="Select a file..." readonly>
          <button id="browse-key-btn" class="browse-btn">Browse</button>
        </div>
      </div>
      <div class="code-block">
&lt;StorageFileBrowser 
  triggerId="browse-key-btn" 
  targetInputId="storage-key"
  returnType="key"
/&gt;
      </div>
    </div>

    <!-- Example 4: Files only (no folders) -->
    <div class="demo-section">
      <h2>Example 4: Files Only (No Folder Navigation)</h2>
      <div class="form-group">
        <label for="file-only">File URL:</label>
        <div class="input-with-button">
          <input type="text" id="file-only" class="form-input" placeholder="Select a file..." readonly>
          <button id="browse-files-btn" class="browse-btn">Browse Files</button>
        </div>
      </div>
      <div class="code-block">
&lt;StorageFileBrowser 
  triggerId="browse-files-btn" 
  targetInputId="file-only"
  filesOnly={true}
  returnType="url"
/&gt;
      </div>
    </div>

    <!-- Props Documentation -->
    <div class="demo-section">
      <h2>Component Props</h2>
      <table style="width: 100%; border-collapse: collapse;">
        <thead>
          <tr style="background: #f8f9fa; text-align: left;">
            <th style="padding: 0.5rem; border: 1px solid #dee2e6;">Prop</th>
            <th style="padding: 0.5rem; border: 1px solid #dee2e6;">Type</th>
            <th style="padding: 0.5rem; border: 1px solid #dee2e6;">Default</th>
            <th style="padding: 0.5rem; border: 1px solid #dee2e6;">Description</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td style="padding: 0.5rem; border: 1px solid #dee2e6;"><code>triggerId</code></td>
            <td style="padding: 0.5rem; border: 1px solid #dee2e6;">string</td>
            <td style="padding: 0.5rem; border: 1px solid #dee2e6;">required</td>
            <td style="padding: 0.5rem; border: 1px solid #dee2e6;">ID of button that opens the browser</td>
          </tr>
          <tr>
            <td style="padding: 0.5rem; border: 1px solid #dee2e6;"><code>targetInputId</code></td>
            <td style="padding: 0.5rem; border: 1px solid #dee2e6;">string</td>
            <td style="padding: 0.5rem; border: 1px solid #dee2e6;">required</td>
            <td style="padding: 0.5rem; border: 1px solid #dee2e6;">ID of input to populate with selected file</td>
          </tr>
          <tr>
            <td style="padding: 0.5rem; border: 1px solid #dee2e6;"><code>title</code></td>
            <td style="padding: 0.5rem; border: 1px solid #dee2e6;">string</td>
            <td style="padding: 0.5rem; border: 1px solid #dee2e6;">'Select File'</td>
            <td style="padding: 0.5rem; border: 1px solid #dee2e6;">Modal title</td>
          </tr>
          <tr>
            <td style="padding: 0.5rem; border: 1px solid #dee2e6;"><code>fileTypes</code></td>
            <td style="padding: 0.5rem; border: 1px solid #dee2e6;">string[]</td>
            <td style="padding: 0.5rem; border: 1px solid #dee2e6;">[]</td>
            <td style="padding: 0.5rem; border: 1px solid #dee2e6;">Filter by MIME types (e.g., ['image/jpeg', 'image/png'])</td>
          </tr>
          <tr>
            <td style="padding: 0.5rem; border: 1px solid #dee2e6;"><code>filesOnly</code></td>
            <td style="padding: 0.5rem; border: 1px solid #dee2e6;">boolean</td>
            <td style="padding: 0.5rem; border: 1px solid #dee2e6;">false</td>
            <td style="padding: 0.5rem; border: 1px solid #dee2e6;">Hide folders, show only files</td>
          </tr>
          <tr>
            <td style="padding: 0.5rem; border: 1px solid #dee2e6;"><code>returnType</code></td>
            <td style="padding: 0.5rem; border: 1px solid #dee2e6;">'url' | 'identifier' | 'key'</td>
            <td style="padding: 0.5rem; border: 1px solid #dee2e6;">'url'</td>
            <td style="padding: 0.5rem; border: 1px solid #dee2e6;">What to return: URL, storage-file:// identifier, or storage key</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Include the file browser components -->
  <StorageFileBrowser 
    triggerId="browse-url-btn" 
    targetInputId="file-url"
    returnType="url"
  />

  <StorageFileBrowser 
    triggerId="browse-image-btn" 
    targetInputId="image-identifier"
    fileTypes={['image/jpeg', 'image/png', 'image/webp', 'image/gif']}
    returnType="identifier"
  />

  <StorageFileBrowser 
    triggerId="browse-key-btn" 
    targetInputId="storage-key"
    returnType="key"
  />

  <StorageFileBrowser 
    triggerId="browse-files-btn" 
    targetInputId="file-only"
    filesOnly={true}
    returnType="url"
  />

  <script>
    // Preview image when identifier changes
    const imageIdentifierInput = document.getElementById('image-identifier') as HTMLInputElement;
    const imagePreview = document.getElementById('image-preview') as HTMLElement;

    imageIdentifierInput?.addEventListener('change', async () => {
      const identifier = imageIdentifierInput.value;
      if (!identifier) {
        imagePreview.innerHTML = 'No image selected';
        imagePreview.classList.add('empty');
        return;
      }

      try {
        // Resolve the identifier to get URL
        const response = await fetch('/api/storage', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ action: 'resolveUrl', identifier }),
        });

        const { url } = await response.json();
        imagePreview.innerHTML = `<img src="${url}" alt="Preview">`;
        imagePreview.classList.remove('empty');
      } catch (err) {
        imagePreview.innerHTML = `<span style="color: #dc3545;">Failed to load preview</span>`;
        imagePreview.classList.remove('empty');
      }
    });
  </script>
</body>
</html>
